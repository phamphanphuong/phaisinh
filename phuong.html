<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Ph∆∞∆°ng</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      :root {
        --primary: #2962ff; /* Xanh d∆∞∆°ng ƒë·∫≠m - m√†u ch√≠nh c·ªßa TradingView */
        --bg: #131722; /* X√°m ƒë·∫≠m - n·ªÅn ch√≠nh */
        --card-bg: #1c2535; /* X√°m ƒë·∫≠m h∆°n - n·ªÅn card */
        --text: #d1d4dc; /* Tr·∫Øng x√°m - ch·ªØ ch√≠nh */
        --text-muted: #787b86; /* X√°m nh·∫°t - ch·ªØ ph·ª• */
        --border: #2a2e39; /* Vi·ªÅn x√°m ƒë·∫≠m */
        --green: #00c087; /* Xanh l√° - tƒÉng tr∆∞·ªüng */
        --red: #ff3366; /* ƒê·ªè - gi·∫£m */
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
        padding: 1rem;
        line-height: 1.6;
      }

      h1 {
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        text-align: center;
        color: var(--primary);
      }

      h2 {
        font-size: 1.2rem;
        margin-bottom: 0.8rem;
        color: var(--text);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .card {
        background: var(--card-bg);
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        border: 1px solid var(--border);
      }

      .table-wrapper {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        table-layout: auto;
        font-size: 0.9rem;
      }

      th,
      td {
        padding: 0.75rem 1rem;
        border: 1px solid var(--border);
        text-align: center;
        white-space: nowrap;
      }

      th {
        background: var(--card-bg);
        color: var(--text-muted);
        font-weight: 500;
        text-transform: uppercase;
        font-size: 0.8rem;
      }

      tr.green {
        background-color: rgba(0, 192, 135, 0.15); /* Xanh l√° nh·∫°t */
      }

      tr.red {
        background-color: rgba(255, 51, 102, 0.15); /* ƒê·ªè nh·∫°t */
      }

      button {
        background: var(--primary);
        color: #ffffff;
        border: none;
        padding: 0.4rem 0.8rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background 0.2s ease;
      }

      button:hover {
        background: #1a4ed8; /* Xanh d∆∞∆°ng ƒë·∫≠m h∆°n khi hover */
      }

      #balance {
        font-size: 1.2rem;
        color: var(--primary);
        font-weight: 500;
      }

      #status {
        font-size: 0.9rem;
        color: var(--text-muted);
        text-align: center;
      }

      /* Responsive adjustments */
      @media (max-width: 600px) {
        th,
        td {
          padding: 0.5rem;
          min-width: 90px;
        }
      }
    </style>
  </head>

  <body>
    <h1>üìä Ph∆∞∆°ng Bot</h1>

    <div class="card">
      <h2>
        S·ªë d∆∞
        <button onclick="manualUpdate()">üîÑ C·∫≠p nh·∫≠t ngay</button>
      </h2>
      <div id="balance">ƒêang t·∫£i...</div>
    </div>

    <div class="card">
      <h2>Positions</h2>
      <div class="table-wrapper">
        <table id="positionsTable">
          <thead>
            <tr>
              <th>Symbol</th>
              <th>Buy</th>
              <th>Sell</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <h2>Orders</h2>
      <div class="table-wrapper">
        <table id="ordersTable">
          <thead>
            <tr>
              <th>Symbol</th>
              <th>Buy</th>
              <th>Sell</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <h2>Tr·∫°ng th√°i</h2>
      <div id="status">Ch·ªù k·∫øt n·ªëi auto bot...</div>
    </div>

    <script>
      const socketUrl = "wss://web-production-6872a.up.railway.app/ws";
      const socket = new WebSocket(socketUrl);

      socket.onopen = () => {
        socket.send("phuong");
        const statusElement = document.getElementById("status");
        if (statusElement) {
          statusElement.innerText = "üîó ƒê√£ k·∫øt n·ªëi auto bot";
        } else {
          console.error("Element with ID 'status' not found in the DOM.");
        }
      };

      socket.onmessage = function (event) {
        const data = JSON.parse(event.data);
        updateUI(data);
      };

      socket.onerror = () => {
        document.getElementById("status").innerText = "‚ùå L·ªói k·∫øt n·ªëi auto bot";
      };

      socket.onclose = () => {
        document.getElementById("status").innerText =
          "üîå K·∫øt n·ªëi v·ªõi auto bot ƒë√£ ƒë√≥ng";
      };

      function updateUI(data) {
        document.getElementById("balance").innerText =
          (data.balance / 1_000_000).toFixed(1) + " tr";
        document.getElementById("status").innerText = data.status;

        const posBody = document.querySelector("#positionsTable tbody");
        const ordBody = document.querySelector("#ordersTable tbody");
        posBody.innerHTML = "";
        ordBody.innerHTML = "";

        for (const bot in data.positions) {
          const pos = data.positions[bot];
          const ord = data.orders[bot];

          const posClass =
            pos.buy > pos.sell ? "green" : pos.sell > pos.buy ? "red" : "";
          const ordClass =
            ord.buy > ord.sell ? "green" : ord.sell > ord.buy ? "red" : "";

          posBody.innerHTML += `
            <tr class="${posClass}">
              <td>${bot}</td>
              <td>${pos.buy}</td>
              <td>${pos.sell}</td>
            </tr>
          `;

          ordBody.innerHTML += `
            <tr class="${ordClass}">
              <td>${bot}</td>
              <td>${ord.buy}</td>
              <td>${ord.sell}</td>
            </tr>
          `;
        }
      }

      function manualUpdate() {
        fetch("https://web-production-6872a.up.railway.app/status/phuong")
          .then((res) => res.json())
          .then((data) => {
            updateUI(data);
          })
          .catch(() => {
            alert("L·ªói khi g·ªçi GET /status");
          });
      }
    </script>
  </body>
</html>
